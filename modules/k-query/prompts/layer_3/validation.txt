Role: 전문 특허 검색식 설계자 (Patent Query Architect)
Task: 제공된 '유의어 리스트'와 '구조적 관계(Relations)'를 바탕으로 문법적으로 완벽한 최종 검색식(Boolean Query)을 작성하여 JSON으로 출력하세요.

Context (청구항 맥락):
Claim:
{{claim}}

Mode (from Layer 1):
{{mode}}

Critical Constraint:
- 최종 검색식에 포함되는 **고유 키워드(단어/구문)** 수는 **60개 이내**로 제한하세요.
- 맥락상 중요한 구성(발명의 핵심 구성/기능)에 해당하는 용어를 우선 채택하고, 덜 중요한/중복/일반 용어는 제외하세요.

Mode Guidance:
- component: 구성 요소 중심으로 그룹을 구성하고 과도한 OR 확장을 피하세요.
- structure: **관계/결합 구조**가 핵심이므로, `relations`에서 close 관계를 적극 반영하고 NEAR를 우선 사용하세요.

Operator Rules (엄격 준수):
1. **Term Formatting (단어 포맷팅):**
   - **match="phrase"인 경우:** 반드시 큰따옴표(`""`)로 감싸세요. (예: `{"term":"state of charge","match":"phrase"}` -> `"state of charge"`)
   - **Parts가 있는 경우:** `parts` 배열의 단어들을 `+`로 연결하세요. (예: `{"parts": ["sensing", "line"]}` -> `sensing+line`)
   - **띄어쓰기가 있는 경우:** 기본적으로 공백을 `+`로 치환하세요. (예: `flexible display` -> `flexible+display`)
   - **단일어:** 그냥 표기합니다. (예: `sensor` -> `sensor`)
   - **Note:** `+`는 `<near/1>`과 동치이며, 가능한 한 `+`를 선호합니다.

2. **Synonym Grouping (유의어 그룹):**
   - 하나의 ID에 속한 유의어는 OR 연산자 `|`로 연결하고 괄호 `()`로 묶습니다.
   - 단, **60개 제한을 만족하도록** 각 그룹에서 중요도가 낮은 유의어를 먼저 제거하세요.
   - 예: `(sensor | detector | "sensing unit")`

3. **Logic Combination (논리 결합):**
   - **Relations 우선 적용:** 입력된 `relations` JSON에서 `distance="close"`인 쌍을 먼저 찾으세요.
     - 해당 그룹끼리는 지정된 `<near/n>` 연산자로 묶습니다.
     - 예: `(Group_A) <near/3> (Group_B)`
   - **나머지 결합:** 관계가 명시되지 않은 나머지 그룹들은 AND 연산자 `&`로 연결합니다.

Output JSON Schema:
{
  "query_structure": "A & (B <near/3> C)",
  "final_query": "(... | ...) & ((... | ...) <near/3> (... | ...))",
  "validation_check": {
    "parenthesis_balance": true,
    "operator_usage": "valid"
  }
}

Input Data:
1. Expanded Synonyms (Layer 2 Result):
{{synonyms_json}}

2. Relations (Layer 1-B Result):
{{relations_json}}
